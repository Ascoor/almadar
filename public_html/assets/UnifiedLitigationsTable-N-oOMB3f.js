import{r as c,j as e,K as R,s as P,l as F,g as B,C as O}from"./pdf-D5yLTPdL.js";import{t as f,ar as D,as as I,$ as E,at as Y,A,au as G,av as H,aw as K,B as Q,Q as U}from"./index-BrCJu-Nk.js";import{T as W}from"./TableComponent-oB2Hgwhz.js";import{M}from"./ModalCard-BQAsNCRr.js";import T from"./GlobalConfirmDeleteModal-POJBepxz.js";import"./react-UnWXGYuj.js";import"./vendor-CTvvdsW_.js";const N={id:null,case_number:"",case_year:"",court:"",opponent:"",scope:"from",subject:"",filing_date:"",status:"open",notes:""};function z({isOpen:o,onClose:b,initialData:l=null,reloadLitigations:p}){const[t,u]=c.useState(N),[m,x]=c.useState({}),[g,d]=c.useState(!1);c.useEffect(()=>{o&&(u(l?{...N,...l,filing_date:l.filing_date?.slice(0,10)||""}:N),x({}))},[o,l]);const r=a=>{const{name:s,value:h}=a.target;u(y=>({...y,[s]:s==="case_year"?String(h):h})),x(y=>({...y,[s]:""}))},w=()=>{const a={};return t.scope||(a.scope="الرجاء تحديد صفة الشركة"),t.case_number||(a.case_number="رقم الدعوى مطلوب"),t.case_year||(a.case_year="سنة الدعوى مطلوبة"),t.court||(a.court="اسم المحكمة مطلوب"),t.opponent||(a.opponent="اسم الخصم مطلوب"),t.subject||(a.subject="موضوع الدعوى مطلوب"),t.filing_date||(a.filing_date="تاريخ رفع الدعوى مطلوب"),t.status||(a.status="حالة الدعوى مطلوبة"),a},j=async()=>{const a=w();if(Object.keys(a).length>0){x(a),f.error("يرجى تصحيح الأخطاء في النموذج");return}d(!0);try{const s={...t,case_year:String(t.case_year)};t.id?(await D(t.id,s),f.success("✅ تم تعديل الدعوى بنجاح")):(await I(s),f.success("✅ تمت إضافة الدعوى بنجاح")),p?.(),b()}catch(s){const h=s?.response?.data?.errors;if(h){const y={};Object.entries(h).forEach(([n,_])=>{y[n]=_[0],f.error(`❌ ${_[0]}`)}),x(y)}else f.error("❌ فشل الحفظ. تحقق من البيانات.")}finally{d(!1)}};return e.jsxs(M,{isOpen:o,title:l?"تعديل دعوى":"إضافة دعوى",loading:g,onClose:b,onSubmit:j,submitLabel:l?"تحديث":"إضافة",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{label:"صفة الشركة",name:"scope",type:"select",options:[{value:"from",label:"من الشركة"},{value:"against",label:"ضد الشركة"}]},{label:"رقم الدعوى",name:"case_number"},{label:"سنة الدعوى",name:"case_year"},{label:"المحكمة",name:"court"},{label:"الخصم",name:"opponent"},{label:"الموضوع",name:"subject"},{label:"تاريخ رفع الدعوى",name:"filing_date",type:"date"},{label:"الحالة",name:"status",type:"select",options:[{value:"open",label:"مفتوحة"},{value:"in_progress",label:"قيد التنفيذ"},{value:"closed",label:"مغلقة"}]}].map(({label:a,name:s,type:h="text",options:y})=>e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-muted-foreground",children:a}),h==="select"?e.jsx("select",{name:s,value:t[s],onChange:r,required:!0,className:`w-full px-3 py-2 rounded-lg border ${m[s]?"border-red-500":"border-border"} bg-background text-foreground`,children:y.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))}):e.jsx("input",{type:h,name:s,value:t[s],onChange:r,required:!0,className:`w-full px-3 py-2 rounded-lg border ${m[s]?"border-red-500":"border-border"} bg-background text-foreground`}),m[s]&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:m[s]})]},s))}),e.jsxs("div",{className:"md:col-span-2 mt-4",children:[e.jsx("label",{className:"block mb-1 text-sm text-muted-foreground",children:"ملاحظات"}),e.jsx("textarea",{name:"notes",value:t.notes,onChange:r,rows:3,className:"w-full px-3 py-2 rounded-lg border border-border bg-background text-foreground"})]})]})}const C={id:null,action_date:"",action_type_id:"",lawyer_name:"",requirements:"",location:"",notes:"",results:"",status:"pending"};function J({isOpen:o,onClose:b,onSubmit:l,initialData:p}){const[t,u]=c.useState(C),[m,x]=c.useState(!1),{data:g=[],isLoading:d}=E("litigation");c.useEffect(()=>{o&&u(p?{...C,...p}:C)},[o,p]);const r=j=>{const{name:a,value:s}=j.target;u(h=>({...h,[a]:s}))},w=async()=>{x(!0);try{await l(t),b()}catch{f.error("فشل في حفظ الإجراء")}finally{x(!1)}};return o?e.jsx(M,{isOpen:o,title:t.id?"تعديل إجراء":"إضافة إجراء",onClose:b,onSubmit:w,loading:m,submitLabel:t.id?"تحديث":"إضافة",children:e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-right",children:[e.jsx(k,{label:"تاريخ الإجراء",name:"action_date",type:"date",value:t.action_date,onChange:r}),e.jsx(k,{label:"نوع الإجراء",name:"action_type_id",type:"select",options:g.map(j=>({value:j.id,label:j.action_name})),value:t.action_type_id,onChange:r,disabled:d}),e.jsx(k,{label:"اسم القائم بالإجراء",name:"lawyer_name",type:"text",value:t.lawyer_name,onChange:r,placeholder:"مثال: د. فاطمة"}),e.jsx(k,{label:"المطلوب",name:"requirements",type:"text",value:t.requirements,onChange:r}),e.jsx(k,{label:"جهة الإجراء",name:"location",type:"text",value:t.location,onChange:r}),e.jsx(k,{label:"النتيجة",name:"results",type:"text",value:t.results,onChange:r}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block mb-1 text-sm",children:"ملاحظات"}),e.jsx("textarea",{name:"notes",value:t.notes??"",onChange:r,className:"w-full p-2 border rounded-lg",rows:2})]}),e.jsx(k,{label:"الحالة",name:"status",type:"select",options:[{value:"pending",label:"معلق"},{value:"in_review",label:"قيد المراجعة"},{value:"done",label:"منجز"}],value:t.status,onChange:r})]})}):null}function k({label:o,name:b,type:l,options:p=[],value:t,onChange:u,placeholder:m,disabled:x=!1}){const g="w-full p-2 border rounded-md bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:outline-none";return e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:o}),l==="select"?e.jsxs("select",{name:b,value:t??"",onChange:u,disabled:x,className:g,required:!0,children:[e.jsxs("option",{value:"",children:["اختر ",o]}),p.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))]}):e.jsx("input",{type:l,name:b,value:t??"",onChange:u,className:g,placeholder:m,required:!0})]})}function V({litigationId:o,scope:b,reloadLitigations:l}){const[p,t]=c.useState(!1),[u,m]=c.useState(null),[x,g]=c.useState(null),{data:d=[],refetch:r}=Y(o),{data:w=[]}=E("litigation"),{hasPermission:j}=c.useContext(A),a=b==="from"?"litigation-from-actions":"litigation-against-actions",s=n=>j(`${n} ${a}`),h=async n=>{try{u?(await G(o,u.id,n),f.success("تم تعديل الإجراء")):(await H(o,n),f.success("تمت إضافة الإجراء")),t(!1),r(),l()}catch{f.error("فشل في حفظ الإجراء")}},y=async()=>{try{await K(o,x.id),f.success("تم حذف الإجراء"),g(null),r(),l()}catch{f.error("فشل في حذف الإجراء")}};return s("view")?e.jsxs("div",{className:"mt-6 border rounded-xl text-center p-4 bg-white dark:bg-navy-dark/60",children:[e.jsx("h3",{className:"text-lg md:text-xl font-bold text-royal dark:text-gold/80",children:"إجراءات الدعوى"}),s("create")&&e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>{m(null),t(!0)},className:"group flex items-center gap-2 px-5 py-2.5 rounded-lg text-white dark:text-gray-900 bg-gradient-to-r from-blue-600 to-indigo-700 dark:from-yellow-400 dark:to-yellow-600 shadow-lg hover:scale-[1.03] transition-all",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:"إضافة إجراء"})]})}),d.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"لا توجد إجراءات مسجلة لهذه الدعوى."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-center border-collapse text-gray-800 dark:text-gray-200",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800/90 text-gray-600 dark:text-greenic-light font-semibold",children:e.jsxs("tr",{children:[s("edit")&&e.jsx("th",{children:"تعديل"}),s("delete")&&e.jsx("th",{children:"حذف"}),e.jsx("th",{children:"تاريخ الإجراء"}),e.jsx("th",{children:"نوع الإجراء"}),e.jsx("th",{children:"المحامي / المستشار"}),e.jsx("th",{children:"المتطلبات"}),e.jsx("th",{children:"النتيجة"}),e.jsx("th",{children:"الحالة"})]})}),e.jsx("tbody",{children:d.map(n=>e.jsxs("tr",{className:"border-t hover:bg-gray-50 dark:hover:bg-gray-800",children:[s("edit")&&e.jsx("td",{children:e.jsx("button",{onClick:()=>{m(n),t(!0)},className:"text-blue-600 hover:text-green-600 dark:text-yellow-300",children:e.jsx(P,{className:"w-4 h-4"})})}),s("delete")&&e.jsx("td",{children:e.jsx("button",{onClick:()=>g(n),className:"text-red-600 hover:text-red-800",children:e.jsx(F,{className:"w-4 h-4"})})}),e.jsx("td",{children:n.action_date}),e.jsx("td",{children:n.action_type?.action_name||"غير محدد"}),e.jsx("td",{children:n.lawyer_name}),e.jsx("td",{children:n.requirements||"—"}),e.jsx("td",{children:n.results||"—"}),e.jsx("td",{className:"font-medium text-green-600 dark:text-green-300",children:n.status==="pending"?"معلق":n.status==="in_review"?"قيد المراجعة":"منجز"})]},n.id))})]})}),p&&e.jsx(J,{isOpen:p,onClose:()=>t(!1),reloadLitigations:l,actionTypes:w,initialData:u,onSubmit:h}),e.jsx(T,{isOpen:!!x,onClose:()=>g(null),onConfirm:y,itemName:x?.action_type?.action_name||"الإجراء"})]}):e.jsx("div",{className:"p-4 mt-6 mb-6 bg-gray-200 dark:bg-royal-dark rounded-xl border text-center text-red-600 dark:text-yellow-300 font-semibold",children:"ليس لديك صلاحية الاطلاع على الإجراءات"})}function le({litigations:o,scope:b,reloadLitigations:l}){const[p,t]=c.useState(null),[u,m]=c.useState(null),[x,g]=c.useState(!1),[d,r]=c.useState(null),{hasPermission:w}=c.useContext(A),j=`litigation-${b}`,a=i=>{const v=j.split("-");return[j,v.slice(0,2).join("-"),v[0]].some(q=>w(`${i} ${q}`))},s=i=>{t(v=>v===i?null:i)},h=i=>{m(i),g(!0)},y=()=>{m(null),g(!0)},n=async()=>{if(d)try{await U(d.id),f.success("تم حذف الدعوى بنجاح"),await l()}catch{f.error("فشل حذف الدعوى")}finally{r(null)}},_=[{key:"expand",text:""},{key:"case_number",text:"رقم الدعوى"},{key:"court",text:"المحكمة"},{key:"opponent",text:"الخصم"},{key:"subject",text:"الموضوع"},{key:"status",text:"الحالة"}],L={expand:i=>e.jsx("button",{onClick:v=>{v.stopPropagation(),s(i.id)},className:"text-gray-700 dark:text-white",title:"عرض الإجراءات",children:p===i.id?e.jsx(B,{className:"w-4 h-4"}):e.jsx(O,{className:"w-4 h-4"})}),status:i=>{const v={open:"مفتوحة",in_progress:"قيد التنفيذ",closed:"مغلقة"},S={open:"text-green-600",in_progress:"text-yellow-600",closed:"text-gray-500"}[i.status]||"text-gray-400";return e.jsx("span",{className:`font-semibold ${S}`,children:v[i.status]||"غير معروف"})}},$=i=>p===i.id?e.jsx("tr",{children:e.jsx("td",{colSpan:_.length+2,className:"bg-gray-50 dark:bg-navy-darker p-4",children:e.jsx(V,{litigationId:i.id,scope:b,reloadLitigations:l})})},`expanded-${i.id}`):null;return a("view")?e.jsxs(e.Fragment,{children:[e.jsx(W,{data:o,moduleName:j,headers:_,customRenderers:L,onEdit:a("edit")?h:null,onDelete:a("delete")?i=>r(i):null,expandedRowRenderer:$,renderAddButton:a("create")?{render:()=>e.jsxs(Q,{onClick:y,children:["إضافة دعوى",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})]})}:null}),e.jsx(z,{isOpen:x,onClose:()=>g(!1),initialData:u,reloadLitigations:l,onSubmit:l}),e.jsx(T,{isOpen:!!d,itemName:d?.case_number||"الدعوى",onClose:()=>r(null),onConfirm:n})]}):e.jsx("div",{className:"p-6 bg-yellow-100 dark:bg-gray-800 text-center rounded-xl text-red-600 dark:text-yellow-300 font-semibold",children:"ليس لديك صلاحية عرض الدعاوى."})}export{le as default};
