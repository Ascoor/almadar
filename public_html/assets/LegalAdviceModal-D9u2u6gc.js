import{j as e}from"./pdf-_01J5l0m.js";import{a as i}from"./react-DxiZ5OBW.js";import{c as j,t as o,al as y,am as N}from"./index-C9wc903-.js";import{M as A}from"./ModalCard-Bqi_hoDA.js";import"./vendor-CTvvdsW_.js";const b={id:null,advice_type_id:"",topic:"",text:"",requester:"",issuer:"",advice_date:"",advice_number:"",attachment:null,oldAttachment:null};function k({isOpen:m,onClose:u,adviceTypes:x=[],initialData:r=null,reload:h}){const[a,c]=i.useState(b),[f,p]=i.useState(!1);i.useEffect(()=>{m&&c(r?{id:r.id,advice_type_id:r.advice_type_id||"",topic:r.topic||"",text:r.text||"",requester:r.requester||"",issuer:r.issuer||"",advice_date:r.advice_date?.slice(0,10)||"",advice_number:r.advice_number||"",attachment:null,oldAttachment:r.attachment||null}:b)},[m,r]);const n=t=>{const{name:s,value:l,files:v}=t.target;if(s==="attachment"){const d=v[0];if(d&&d.type!=="application/pdf"){o.error("الملف يجب أن يكون بصيغة PDF فقط.");return}c(_=>({..._,attachment:d}))}else c(d=>({...d,[s]:l}))},g=async()=>{p(!0);try{const t=new FormData;Object.entries(a).forEach(([s,l])=>{l!=null&&s!=="oldAttachment"&&t.append(s,l)}),a.id&&t.append("_method","PUT"),a.id?(await y(a.id,t),o.success("✅ تم تعديل المشورة بنجاح")):(await N(t),o.success("✅ تم إضافة المشورة بنجاح")),h?.(),u()}catch(t){o.error("❌ حدث خطأ أثناء الحفظ."),console.error(t)}finally{p(!1)}};return e.jsx(A,{isOpen:m,title:r?"تعديل رأي/مشورة":"إضافة رأي/مشورة جديد",loading:f,onClose:u,onSubmit:g,submitLabel:r?"تحديث":"إضافة",children:e.jsxs("form",{className:"space-y-6 text-right",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"نوع المشورة"}),e.jsxs("select",{name:"advice_type_id",value:a.advice_type_id,onChange:n,required:!0,className:"w-full px-3 py-2 border border-border rounded-lg bg-bg text-fg",children:[e.jsx("option",{value:"",children:"-- اختر نوع المشورة --"}),x.map(t=>e.jsx("option",{value:t.id,children:t.type_name},t.id))]})]}),[{label:"الموضوع",name:"topic",type:"text"},{label:"الجهة الطالبة",name:"requester",type:"text"},{label:"الجهة المصدرة",name:"issuer",type:"text"},{label:"تاريخ المشورة",name:"advice_date",type:"date"},{label:"رقم المشورة",name:"advice_number",type:"text"}].map(({label:t,name:s,type:l})=>e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:t}),e.jsx("input",{type:l,name:s,value:a[s],onChange:n,required:["topic","advice_number"].includes(s),className:"w-full px-3 py-2 border border-border rounded-lg bg-bg text-fg"})]},s))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"نص المشورة"}),e.jsx("textarea",{name:"text",value:a.text,onChange:n,rows:4,className:"w-full px-3 py-2 border border-border rounded-lg bg-bg text-fg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"مرفق PDF"}),e.jsx("input",{type:"file",name:"attachment",accept:"application/pdf",onChange:n,className:"w-full px-3 py-2 border border-border rounded-lg bg-bg text-fg"}),a.attachment?e.jsx("p",{className:"mt-1 text-green-600",children:a.attachment.name}):a.oldAttachment?e.jsx("a",{href:`${j.baseURL}/storage/${a.oldAttachment}`,target:"_blank",rel:"noopener noreferrer",className:"mt-1 text-blue-600 underline block",children:"عرض المرفق الحالي"}):null]})]})})}export{k as default};
