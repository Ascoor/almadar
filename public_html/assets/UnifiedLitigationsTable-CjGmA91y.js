import{j as t}from"./pdf-_01J5l0m.js";import{a as c}from"./react-DxiZ5OBW.js";import{t as m,an as E,ao as S,o as M,A as $,B as L,P as T}from"./index-C9wc903-.js";import{T as A}from"./TableComponent-oKqWs0n5.js";import{M as B}from"./ModalCard-Bqi_hoDA.js";import O from"./GlobalConfirmDeleteModal-DPvq9hXw.js";import"./vendor-CTvvdsW_.js";const k={id:null,case_number:"",case_year:"",court:"",opponent:"",scope:"from",subject:"",filing_date:"",status:"open",notes:""};function R({isOpen:g,onClose:j,initialData:n=null,reloadLitigations:y}){const[r,d]=c.useState(k),[b,i]=c.useState({}),[p,f]=c.useState(!1);c.useEffect(()=>{g&&(d(n?{...k,...n,filing_date:n.filing_date?.slice(0,10)||""}:k),i({}))},[g,n]);const x=e=>{const{name:s,value:o}=e.target;d(l=>({...l,[s]:s==="case_year"?String(o):o})),i(l=>({...l,[s]:""}))},w=()=>{const e={};return r.scope||(e.scope="الرجاء تحديد صفة الشركة"),r.case_number||(e.case_number="رقم الدعوى مطلوب"),r.case_year||(e.case_year="سنة الدعوى مطلوبة"),r.court||(e.court="اسم المحكمة مطلوب"),r.opponent||(e.opponent="اسم الخصم مطلوب"),r.subject||(e.subject="موضوع الدعوى مطلوب"),r.filing_date||(e.filing_date="تاريخ رفع الدعوى مطلوب"),r.status||(e.status="حالة الدعوى مطلوبة"),e},h=async()=>{const e=w();if(Object.keys(e).length>0){i(e),m.error("يرجى تصحيح الأخطاء في النموذج");return}f(!0);try{const s={...r,case_year:String(r.case_year)};r.id?(await E(r.id,s),m.success("✅ تم تعديل الدعوى بنجاح")):(await S(s),m.success("✅ تمت إضافة الدعوى بنجاح")),y?.(),j()}catch(s){const o=s?.response?.data?.errors;if(o){const l={};Object.entries(o).forEach(([u,v])=>{l[u]=v[0],m.error(`❌ ${v[0]}`)}),i(l)}else m.error("❌ فشل الحفظ. تحقق من البيانات.")}finally{f(!1)}};return t.jsxs(B,{isOpen:g,title:n?"تعديل دعوى":"إضافة دعوى",loading:p,onClose:j,onSubmit:h,submitLabel:n?"تحديث":"إضافة",children:[t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{label:"صفة الشركة",name:"scope",type:"select",options:[{value:"from",label:"من الشركة"},{value:"against",label:"ضد الشركة"}]},{label:"رقم الدعوى",name:"case_number"},{label:"سنة الدعوى",name:"case_year"},{label:"المحكمة",name:"court"},{label:"الخصم",name:"opponent"},{label:"الموضوع",name:"subject"},{label:"تاريخ رفع الدعوى",name:"filing_date",type:"date"},{label:"الحالة",name:"status",type:"select",options:[{value:"open",label:"مفتوحة"},{value:"in_progress",label:"قيد التنفيذ"},{value:"closed",label:"مغلقة"}]}].map(({label:e,name:s,type:o="text",options:l})=>t.jsxs("div",{children:[t.jsx("label",{className:"block mb-1 text-sm text-muted",children:e}),o==="select"?t.jsx("select",{name:s,value:r[s],onChange:x,required:!0,className:`w-full px-3 py-2 rounded-lg border ${b[s]?"border-red-500":"border-border"} bg-bg text-fg`,children:l.map(u=>t.jsx("option",{value:u.value,children:u.label},u.value))}):t.jsx("input",{type:o,name:s,value:r[s],onChange:x,required:!0,className:`w-full px-3 py-2 rounded-lg border ${b[s]?"border-red-500":"border-border"} bg-bg text-fg`}),b[s]&&t.jsx("p",{className:"text-red-600 text-sm mt-1",children:b[s]})]},s))}),t.jsxs("div",{className:"md:col-span-2 mt-4",children:[t.jsx("label",{className:"block mb-1 text-sm text-muted",children:"ملاحظات"}),t.jsx("textarea",{name:"notes",value:r.notes,onChange:x,rows:3,className:"w-full px-3 py-2 rounded-lg border border-border bg-bg text-fg"})]})]})}function W({litigations:g,scope:j,reloadLitigations:n,autoOpen:y=!1}){const[r,d]=c.useState(null),[b,i]=c.useState(!1),[p,f]=c.useState(null),x=M(),{hasPermission:w}=c.useContext($),h=`litigation-${j}`,e=a=>{const _=h.split("-");return[h,_.slice(0,2).join("-"),_[0]].some(N=>w(`${a} ${N}`))},s=a=>{d(a),i(!0)},o=()=>{d(null),i(!0)};c.useEffect(()=>{y&&(d(null),i(!0))},[y]);const l=async()=>{if(p)try{await T(p.id),m.success("تم حذف الدعوى بنجاح"),await n()}catch{m.error("فشل حذف الدعوى")}finally{f(null)}},u=[{key:"case_number",text:"رقم الدعوى"},{key:"court",text:"المحكمة"},{key:"opponent",text:"الخصم"},{key:"subject",text:"الموضوع"},{key:"status",text:"الحالة"}],v={status:a=>{const _={open:"مفتوحة",in_progress:"قيد التنفيذ",closed:"مغلقة"},C={open:"text-green-600",in_progress:"text-yellow-600",closed:"text-gray-500"}[a.status]||"text-gray-400";return t.jsx("span",{className:`font-semibold ${C}`,children:_[a.status]||"غير معروف"})}};return e("view")?t.jsxs(t.Fragment,{children:[t.jsx(A,{data:g,moduleName:h,headers:u,customRenderers:v,onEdit:e("edit")?s:null,onDelete:e("delete")?a=>f(a):null,onRowClick:a=>x(`/legal/litigations/${a.id}`,{state:a}),renderAddButton:e("create")?{render:()=>t.jsxs(L,{onClick:o,children:["إضافة دعوى",t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})]})}:null}),t.jsx(R,{isOpen:b,onClose:()=>i(!1),initialData:r,reloadLitigations:n,onSubmit:n}),t.jsx(O,{isOpen:!!p,itemName:p?.case_number||"الدعوى",onClose:()=>f(null),onConfirm:l})]}):t.jsx("div",{className:"p-6 bg-yellow-100 dark:bg-gray-800 text-center rounded-xl text-red-600 dark:text-yellow-300 font-semibold",children:"ليس لديك صلاحية عرض الدعاوى."})}export{W as default};
