import{j as e}from"./pdf-_01J5l0m.js";import{a as h,a2 as N,Q as _,G as C}from"./react-DxiZ5OBW.js";import{Z as w,t as b,ap as A,A as S,aq as T,ar as M,as as q}from"./index-C9wc903-.js";import{M as L}from"./ModalCard-Bqi_hoDA.js";import E from"./GlobalConfirmDeleteModal-DPvq9hXw.js";import"./vendor-CTvvdsW_.js";const v={id:null,action_date:"",action_type_id:"",lawyer_name:"",requirements:"",location:"",notes:"",results:"",status:"pending"};function P({isOpen:s,onClose:u,onSubmit:r,initialData:i}){const[t,n]=h.useState(v),[g,o]=h.useState(!1),{data:d=[],isLoading:c}=w("litigation");h.useEffect(()=>{s&&n(i?{...v,...i}:v)},[s,i]);const l=j=>{const{name:p,value:x}=j.target;n(f=>({...f,[p]:x}))},y=async()=>{o(!0);try{await r(t),u()}catch{b.error("فشل في حفظ الإجراء")}finally{o(!1)}};return s?e.jsx(L,{isOpen:s,title:t.id?"تعديل إجراء":"إضافة إجراء",onClose:u,onSubmit:y,loading:g,submitLabel:t.id?"تحديث":"إضافة",children:e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-right",children:[e.jsx(m,{label:"تاريخ الإجراء",name:"action_date",type:"date",value:t.action_date,onChange:l}),e.jsx(m,{label:"نوع الإجراء",name:"action_type_id",type:"select",options:d.map(j=>({value:j.id,label:j.action_name})),value:t.action_type_id,onChange:l,disabled:c}),e.jsx(m,{label:"اسم القائم بالإجراء",name:"lawyer_name",type:"text",value:t.lawyer_name,onChange:l,placeholder:"مثال: د. فاطمة"}),e.jsx(m,{label:"المطلوب",name:"requirements",type:"text",value:t.requirements,onChange:l}),e.jsx(m,{label:"جهة الإجراء",name:"location",type:"text",value:t.location,onChange:l}),e.jsx(m,{label:"النتيجة",name:"results",type:"text",value:t.results,onChange:l}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block mb-1 text-sm",children:"ملاحظات"}),e.jsx("textarea",{name:"notes",value:t.notes??"",onChange:l,className:"w-full p-2 border rounded-lg",rows:2})]}),e.jsx(m,{label:"الحالة",name:"status",type:"select",options:[{value:"pending",label:"معلق"},{value:"in_review",label:"قيد المراجعة"},{value:"done",label:"منجز"}],value:t.status,onChange:l})]})}):null}function m({label:s,name:u,type:r,options:i=[],value:t,onChange:n,placeholder:g,disabled:o=!1}){const d="w-full p-2 border rounded-md bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:outline-none";return e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:s}),r==="select"?e.jsxs("select",{name:u,value:t??"",onChange:n,disabled:o,className:d,required:!0,children:[e.jsxs("option",{value:"",children:["اختر ",s]}),i.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))]}):e.jsx("input",{type:r,name:u,value:t??"",onChange:n,className:d,placeholder:g,required:!0})]})}function Q({litigationId:s,scope:u,reloadLitigations:r}){const[i,t]=h.useState(!1),[n,g]=h.useState(null),[o,d]=h.useState(null),{data:c=[],refetch:l}=A(s),{data:y=[]}=w("litigation"),{hasPermission:j}=h.useContext(S),p=u==="from"?"litigation-from-actions":"litigation-against-actions",x=a=>j(`${a} ${p}`),f=async a=>{try{n?(await T(s,n.id,a),b.success("تم تعديل الإجراء")):(await M(s,a),b.success("تمت إضافة الإجراء")),t(!1),l(),r()}catch{b.error("فشل في حفظ الإجراء")}},k=async()=>{try{await q(s,o.id),b.success("تم حذف الإجراء"),d(null),l(),r()}catch{b.error("فشل في حذف الإجراء")}};return x("view")?e.jsxs("div",{className:"mt-6 border rounded-xl text-center p-4 bg-white dark:bg-navy-dark/60",children:[e.jsx("h3",{className:"text-lg md:text-xl font-bold text-royal dark:text-gold/80",children:"إجراءات الدعوى"}),x("create")&&e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>{g(null),t(!0)},className:"group flex items-center gap-2 px-5 py-2.5 rounded-lg text-white dark:text-gray-900 bg-gradient-to-r from-blue-600 to-indigo-700 dark:from-yellow-400 dark:to-yellow-600 shadow-lg hover:scale-[1.03] transition-all",children:[e.jsx(N,{className:"w-5 h-5"}),e.jsx("span",{children:"إضافة إجراء"})]})}),c.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"لا توجد إجراءات مسجلة لهذه الدعوى."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-center border-collapse text-gray-800 dark:text-gray-200",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800/90 text-gray-600 dark:text-greenic-light font-semibold",children:e.jsxs("tr",{children:[x("edit")&&e.jsx("th",{children:"تعديل"}),x("delete")&&e.jsx("th",{children:"حذف"}),e.jsx("th",{children:"تاريخ الإجراء"}),e.jsx("th",{children:"نوع الإجراء"}),e.jsx("th",{children:"المحامي / المستشار"}),e.jsx("th",{children:"المتطلبات"}),e.jsx("th",{children:"النتيجة"}),e.jsx("th",{children:"الحالة"})]})}),e.jsx("tbody",{children:c.map(a=>e.jsxs("tr",{className:"border-t hover:bg-gray-50 dark:hover:bg-gray-800",children:[x("edit")&&e.jsx("td",{children:e.jsx("button",{onClick:()=>{g(a),t(!0)},className:"text-blue-600 hover:text-green-600 dark:text-yellow-300",children:e.jsx(_,{className:"w-4 h-4"})})}),x("delete")&&e.jsx("td",{children:e.jsx("button",{onClick:()=>d(a),className:"text-red-600 hover:text-red-800",children:e.jsx(C,{className:"w-4 h-4"})})}),e.jsx("td",{children:a.action_date}),e.jsx("td",{children:a.action_type?.action_name||"غير محدد"}),e.jsx("td",{children:a.lawyer_name}),e.jsx("td",{children:a.requirements||"—"}),e.jsx("td",{children:a.results||"—"}),e.jsx("td",{className:"font-medium text-green-600 dark:text-green-300",children:a.status==="pending"?"معلق":a.status==="in_review"?"قيد المراجعة":"منجز"})]},a.id))})]})}),i&&e.jsx(P,{isOpen:i,onClose:()=>t(!1),reloadLitigations:r,actionTypes:y,initialData:n,onSubmit:f}),e.jsx(E,{isOpen:!!o,onClose:()=>d(null),onConfirm:k,itemName:o?.action_type?.action_name||"الإجراء"})]}):e.jsx("div",{className:"p-4 mt-6 mb-6 bg-gray-200 dark:bg-royal-dark rounded-xl border text-center text-red-600 dark:text-yellow-300 font-semibold",children:"ليس لديك صلاحية الاطلاع على الإجراءات"})}export{Q as default};
