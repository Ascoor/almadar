import{r as o,j as e,K as N,s as w,l as k}from"./pdf-D5yLTPdL.js";import{al as _,$ as C,A,am as S,t as h,an as q,ao as M}from"./index-BrCJu-Nk.js";import{M as T}from"./ModalCard-BQAsNCRr.js";import E from"./GlobalConfirmDeleteModal-POJBepxz.js";import"./react-UnWXGYuj.js";import"./vendor-CTvvdsW_.js";const p={id:null,action_date:"",action_type_id:"",officer_name:"",requirements:"",results:"",status:"pending"};function P({isOpen:a,onClose:d,onSubmit:g,initialData:n,actionTypes:x=[]}){const[s,c]=o.useState(p),[m,u]=o.useState(!1);o.useEffect(()=>{a&&c(n?{...p,...n}:p)},[a,n]);const r=l=>{const{name:b,value:i}=l.target;c(f=>({...f,[b]:i}))},j=async()=>{u(!0);try{await g(s),d()}catch(l){throw l}finally{u(!1)}};return a?e.jsx(T,{isOpen:a,onClose:d,title:s.id?"تعديل إجراء":"إضافة إجراء",submitLabel:s.id?"تحديث":"إضافة",onSubmit:j,loading:m,children:e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-right",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"تاريخ الإجراء"}),e.jsx("input",{type:"date",name:"action_date",value:s.action_date,onChange:r,className:"w-full p-2 border rounded-lg",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"نوع الإجراء"}),e.jsxs("select",{name:"action_type_id",value:s.action_type_id,onChange:r,className:"w-full p-2 border rounded-lg",required:!0,children:[e.jsx("option",{value:"",children:"اختر النوع"}),x.map(l=>e.jsx("option",{value:l.id,children:l.action_name},l.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"اسم القائم بالإجراء"}),e.jsx("input",{type:"text",name:"officer_name",value:s.officer_name,onChange:r,className:"w-full p-2 border rounded-lg",placeholder:"مثال: أ. عبدالله",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"المتطلبات"}),e.jsx("input",{type:"text",name:"requirements",value:s.requirements,onChange:r,className:"w-full p-2 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"النتيجة"}),e.jsx("input",{type:"text",name:"results",value:s.results,onChange:r,className:"w-full p-2 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"الحالة"}),e.jsxs("select",{name:"status",value:s.status,onChange:r,className:"w-full p-2 border rounded-lg",required:!0,children:[e.jsx("option",{value:"pending",children:"معلق"}),e.jsx("option",{value:"in_review",children:"قيد المراجعة"}),e.jsx("option",{value:"done",children:"منجز"})]})]})]})}):null}function G({investigationId:a,reloadInvestigations:d}){const[g,n]=o.useState(!1),[x,s]=o.useState(null),[c,m]=o.useState(null),{data:u=[],refetch:r}=_(a),{data:j=[]}=C("investigation"),{hasPermission:l}=o.useContext(A),b="investigation-actions",i=t=>l(`${t} ${b}`),f=async t=>{try{x?(await S(a,x.id,t),h.success("✅ تم تعديل الإجراء")):(await q(a,t),h.success("✅ تمت إضافة الإجراء")),n(!1),await r(),d()}catch(y){h.error("❌ فشل في حفظ الإجراء"),console.error("Save Error:",y)}},v=async()=>{try{await M(a,c.id),h.success("تم حذف الإجراء"),m(null),r(),d()}catch{h.error("فشل في حذف الإجراء")}};return i("view")?e.jsxs("div",{className:"mt-6 border rounded-xl text-center p-4 bg-white dark:bg-navy-dark/60",children:[e.jsx("h3",{className:"text-lg md:text-xl font-bold text-royal dark:text-gold/80",children:"إجراءات التحقيق"}),i("create")&&e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>{s(null),n(!0)},className:"group flex items-center gap-2 px-5 py-2.5 rounded-lg text-white dark:text-gray-900 bg-gradient-to-r from-blue-600 to-indigo-700 dark:from-yellow-400 dark:to-yellow-600 shadow-lg hover:scale-[1.03] transition-all",children:[e.jsx(N,{className:"w-5 h-5"}),e.jsx("span",{children:"إضافة إجراء"})]})}),u.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"لا توجد إجراءات مسجلة لهذه الدعوى."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-center border-collapse text-gray-800 dark:text-gray-200",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800/90 text-gray-600 dark:text-greenic-light font-semibold",children:e.jsxs("tr",{children:[i("edit")&&e.jsx("th",{children:"تعديل"}),i("delete")&&e.jsx("th",{children:"حذف"}),e.jsx("th",{children:"تاريخ الإجراء"}),e.jsx("th",{children:"نوع الإجراء"}),e.jsx("th",{children:"المحامي / المستشار"}),e.jsx("th",{children:"المتطلبات"}),e.jsx("th",{children:"النتيجة"}),e.jsx("th",{children:"الحالة"})]})}),e.jsx("tbody",{children:u.map(t=>e.jsxs("tr",{className:"border-t hover:bg-gray-50 dark:hover:bg-gray-800",children:[i("edit")&&e.jsx("td",{children:e.jsx("button",{onClick:()=>{s(t),n(!0)},className:"text-blue-600 hover:text-green-600 dark:text-yellow-300",children:e.jsx(w,{className:"w-4 h-4"})})}),i("delete")&&e.jsx("td",{children:e.jsx("button",{onClick:()=>m(t),className:"text-red-600 hover:text-red-800",children:e.jsx(k,{className:"w-4 h-4"})})}),e.jsx("td",{children:t.action_date}),e.jsx("td",{children:t.action_type?.action_name||"غير محدد"}),e.jsx("td",{children:t.officer_name}),e.jsx("td",{children:t.requirements||"—"}),e.jsx("td",{children:t.results||"—"}),e.jsx("td",{className:"font-medium text-green-600 dark:text-green-300",children:t.status==="pending"?"معلق":t.status==="in_review"?"قيد المراجعة":"منجز"})]},t.id))})]})}),g&&e.jsx(P,{isOpen:g,onClose:()=>n(!1),reloadInvestigations:d,actionTypes:j,initialData:x,onSubmit:f}),e.jsx(E,{isOpen:!!c,onClose:()=>m(null),onConfirm:v,itemName:c?.action_type?.action_name||"الإجراء"})]}):e.jsx("div",{className:"p-4 mt-6 mb-6 bg-gray-200 dark:bg-royal-dark rounded-xl border text-center text-red-600 dark:text-yellow-300 font-semibold",children:"ليس لديك صلاحية الاطلاع على الإجراءات"})}export{G as default};
