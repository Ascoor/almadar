import{j as e}from"./pdf-_01J5l0m.js";import{a as l}from"./react-DxiZ5OBW.js";import{T as M}from"./TableComponent-oKqWs0n5.js";import{t as h,ae as S,af as F,o as T,B as A,ag as B}from"./index-C9wc903-.js";import{M as L}from"./ModalCard-Bqi_hoDA.js";import O from"./GlobalConfirmDeleteModal-DPvq9hXw.js";import"./vendor-CTvvdsW_.js";const C={id:null,contract_category_id:"",scope:"local",number:"",value:"",contract_parties:"",start_date:"",end_date:"",notes:"",status:"active",summary:"",attachment:null,oldAttachment:null};function P({isOpen:b,onClose:f,initialData:s=null,categories:_=[],reloadContracts:g}){const[a,i]=l.useState(C),[j,o]=l.useState({}),[c,d]=l.useState(!1),[y,v]=l.useState(!1);l.useEffect(()=>{b&&(s?(i({id:s.id||null,contract_category_id:s.contract_category_id||"",scope:s.scope||"local",number:s.number||"",value:s.value!=null?s.value:"",contract_parties:s.contract_parties||"",start_date:s.start_date?s.start_date.slice(0,10):"",end_date:s.end_date?s.end_date.slice(0,10):"",notes:s.notes||"",status:s.status||"active",summary:s.summary||"",attachment:null,oldAttachment:s.attachment||null}),d(!!s.end_date)):(i(C),d(!1)),o({}))},[b,s]);const N=()=>{const t={};return a.contract_category_id||(t.contract_category_id="Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ù…Ø·Ù„ÙˆØ¨."),a.number||(t.number="ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯."),a.value||(t.value="ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù‚Ø¯."),a.contract_parties||(t.contract_parties="ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø·Ø±Ø§Ù Ø§Ù„Ø¹Ù‚Ø¯."),a.start_date||(t.start_date="ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©."),a.summary||(t.summary="ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù…Ù„Ø®Øµ Ù„Ù„Ø¹Ù‚Ø¯."),c&&!a.end_date&&(t.end_date="ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡."),o(t),Object.keys(t).length===0},r=t=>{const{name:m,value:p,files:w}=t.target;if(m==="attachment"){const x=w[0];if(x&&x.type!=="application/pdf"){h.error("ðŸ“„ Ø§Ù„Ù…Ù„Ù ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ØµÙŠØºØ© PDF ÙÙ‚Ø·.");return}i(E=>({...E,attachment:x}))}else i(x=>({...x,[m]:p}));o(x=>({...x,[m]:void 0}))},k=async()=>{if(!N()){h.warning("âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©.");return}v(!0);try{const t=new FormData;Object.entries(a).forEach(([m,p])=>{m==="attachment"&&p instanceof File?t.append("attachment",p):m!=="attachment"&&m!=="oldAttachment"&&p!=null&&t.append(m,p)}),a.id?(t.append("_method","PUT"),await S(a.id,t),h.success("âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø¯ Ø¨Ù†Ø¬Ø§Ø­")):(await F(t),h.success("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù‚Ø¯ Ø¨Ù†Ø¬Ø§Ø­")),g?.(),f(),i(C)}catch(t){console.error(t),h.error("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¹Ù‚Ø¯.")}finally{v(!1)}},n=t=>`w-full p-2 border rounded-lg ${j[t]?"border-red-500 dark:border-red-400 bg-red-50 dark:bg-red-900/30":"border-gray-300 dark:border-zinc-700"}`,u=t=>j[t]?e.jsx("p",{className:"text-xs text-red-600 mt-1",children:j[t]}):null;return e.jsx(L,{isOpen:b,title:s?"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø¯":"Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø¯ Ø¬Ø¯ÙŠØ¯",loading:y,onClose:f,onSubmit:k,submitLabel:s?"ØªØ­Ø¯ÙŠØ«":"Ø¥Ø¶Ø§ÙØ©",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-right",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"Ø§Ù„ØªØµÙ†ÙŠÙ"}),e.jsxs("select",{name:"contract_category_id",value:a.contract_category_id,onChange:r,className:n("contract_category_id"),required:!0,children:[e.jsx("option",{value:"",children:"Ø§Ø®ØªØ± ØªØµÙ†ÙŠÙ"}),_.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),u("contract_category_id")]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø¯"}),e.jsxs("select",{name:"scope",value:a.scope,onChange:r,className:n("scope"),children:[e.jsx("option",{value:"local",children:"Ù…Ø­Ù„ÙŠ"}),e.jsx("option",{value:"international",children:"Ø¯ÙˆÙ„ÙŠ"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯"}),e.jsx("input",{name:"number",value:a.number,onChange:r,className:n("number")}),u("number")]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù‚Ø¯"}),e.jsx("input",{type:"number",name:"value",value:a.value,onChange:r,className:n("value")}),u("value")]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block mb-1 text-sm",children:"Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø§Ù„Ù…ØªØ¹Ø§Ù‚Ø¯ Ù…Ø¹Ù‡Ø§"}),e.jsx("textarea",{name:"contract_parties",value:a.contract_parties,onChange:r,rows:2,className:n("contract_parties")}),u("contract_parties")]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:c?"ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ù‚Ø¯":"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ù‚Ø¯"}),e.jsx("input",{type:"date",name:"start_date",value:a.start_date,onChange:r,className:n("start_date")}),u("start_date"),c&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block mb-1 text-sm",children:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©"}),e.jsx("input",{type:"date",name:"end_date",value:a.end_date,onChange:r,className:n("end_date")}),u("end_date")]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Ù‡Ù„ Ù„Ù„Ø¹Ù‚Ø¯ Ù…Ø¯Ø©ØŸ"}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"hasDuration",checked:c,onChange:()=>d(!0)}),e.jsx("span",{children:"Ù†Ø¹Ù…"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"hasDuration",checked:!c,onChange:()=>d(!1)}),e.jsx("span",{children:"Ù„Ø§"})]})]})]}),s&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block mb-1 text-sm",children:"Ø§Ù„Ø­Ø§Ù„Ø©"}),e.jsxs("select",{name:"status",value:a.status,onChange:r,className:n("status"),children:[e.jsx("option",{value:"active",children:"Ø³Ø§Ø±ÙŠ"}),e.jsx("option",{value:"expired",children:"Ù…Ù†ØªÙ‡ÙŠ"}),e.jsx("option",{value:"terminated",children:"Ù…ÙØ³ÙˆØ®"}),e.jsx("option",{value:"pending",children:"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±"}),e.jsx("option",{value:"cancelled",children:"Ù…Ù„ØºÙŠ"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block mb-1 text-sm",children:"Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ù‚Ø¯"}),e.jsx("textarea",{name:"summary",value:a.summary,onChange:r,rows:3,className:n("summary")}),u("summary")]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block mb-1 text-sm",children:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"}),e.jsx("textarea",{name:"notes",value:a.notes,onChange:r,rows:2,className:n("notes")})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block mb-1 text-sm",children:"Ù…Ø±ÙÙ‚ Ø§Ù„Ø¹Ù‚Ø¯ (PDF ÙÙ‚Ø·)"}),e.jsx("input",{type:"file",name:"attachment",accept:"application/pdf",onChange:r,className:n("attachment")}),a.attachment?e.jsx("p",{className:"mt-1 text-sm text-green-600",children:a.attachment.name}):a.oldAttachment?e.jsx("a",{href:`/storage/${a.oldAttachment}`,target:"_blank",rel:"noopener noreferrer",className:"mt-1 block text-sm text-blue-600 underline",children:"Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±ÙÙ‚ Ø§Ù„Ø­Ø§Ù„ÙŠ"}):null]})]})})}function U({contracts:b=[],categories:f=[],reloadContracts:s,scope:_,autoOpen:g=!1}){const[a,i]=l.useState(null),[j,o]=l.useState(!1),[c,d]=l.useState(null),y=T(),v=b.filter(n=>n.scope===_);l.useEffect(()=>{g&&o(!0)},[g]);const N=n=>{i(n),o(!0)},r=n=>{d(n)},k=async()=>{if(c)try{await B(c.id),h.success("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø¯ Ø¨Ù†Ø¬Ø§Ø­"),s?.()}catch{h.error("âŒ ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø¯")}finally{d(null)}};return e.jsxs(e.Fragment,{children:[e.jsx(M,{moduleName:"contracts",data:v,headers:[{key:"number",text:"Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯"},{key:"category_name",text:"Ø§Ù„ØªØµÙ†ÙŠÙ"},{key:"contract_parties",text:"Ø§Ù„Ù…ØªØ¹Ø§Ù‚Ø¯ Ù…Ø¹Ù‡"},{key:"value",text:"Ø§Ù„Ù‚ÙŠÙ…Ø©"},{key:"attachment",text:"Ø§Ù„Ù…Ø±ÙÙ‚"},{key:"status",text:"Ø§Ù„Ø­Ø§Ù„Ø©"}],customRenderers:{category_name:n=>n.category?.name||"â€”"},onEdit:N,onDelete:r,renderAddButton:{action:"create",render:()=>e.jsxs(A,{onClick:()=>o(!0),children:["Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø¯ Ø¬Ø¯ÙŠØ¯",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})]})},onRowClick:n=>y(`/contracts/${n.id}`,{state:n})})," ",e.jsx(P,{isOpen:j,onClose:()=>o(!1),initialData:a,categories:f,reloadContracts:s}),e.jsx(O,{isOpen:!!c,onClose:()=>d(null),onConfirm:k,itemName:c?.number})]})}export{U as default};
